<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>AcentoF√°cil</title>
  <link rel="manifest" href="manifest.json" />
  <link rel="icon" href="images/icon-192.png" type="image/png" />
  <style>
    /* Fondo degradado suave: azul cielo y blanco */
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      max-width: 900px;
      margin: 0 auto;
      padding: 20px;
      background: linear-gradient(135deg, #f0f7ff 0%, #ffffff 100%);
      background-attachment: fixed;
      color: #2c3e50;
      line-height: 1.7;
      min-height: 100vh;
      margin: 0;
    }

    /* SELLO DE AGUA: "El profesor de espa√±ol" */
    body::after {
      content: "El profesor de espa√±ol";
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%) rotate(-30deg);
      font-size: 36px;
      font-weight: bold;
      color: rgba(0, 100, 200, 0.07);
      pointer-events: none;
      z-index: -1;
      white-space: nowrap;
      font-family: 'Georgia', serif;
      letter-spacing: 1px;
    }

    /* Logo y encabezado */
    .logo-container {
      text-align: center;
      margin-bottom: 10px;
    }

    .logo-container img {
      max-width: 300px;
      height: auto;
      border-radius: 12px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }

    .subtitle {
      text-align: center;
      color: #0055aa;
      font-style: italic;
      margin: 5px 0 25px;
      font-weight: 500;
      font-size: 16px;
    }

    /* Campo de entrada moderno */
    input[type="text"] {
      width: 70%;
      max-width: 400px;
      padding: 12px 16px;
      font-size: 18px;
      border: 2px solid #0077cc;
      border-radius: 14px;
      outline: none;
      transition: all 0.3s;
      background: white;
    }

    input[type="text"]:focus {
      border-color: #003366;
      box-shadow: 0 0 15px rgba(0, 120, 200, 0.2);
      transform: scale(1.02);
    }

    /* Botones con efecto hover */
    button {
      background: #003366;
      color: white;
      border: none;
      padding: 12px 18px;
      font-size: 16px;
      border-radius: 14px;
      cursor: pointer;
      margin: 8px 4px;
      transition: all 0.3s;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }

    button:hover {
      background: #001f33;
      transform: translateY(-2px);
      box-shadow: 0 6px 12px rgba(0,0,0,0.15);
    }

    /* Resultado con estilo tarjeta */
    .resultado {
      background: white;
      padding: 22px;
      border-radius: 18px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.1);
      border: 1px solid #e0e0e0;
      margin-top: 25px;
      transition: all 0.4s;
    }

    .resultado:hover {
      transform: translateY(-3px);
      box-shadow: 0 10px 25px rgba(0,0,0,0.12);
    }

    .silabas {
      font-weight: bold;
      color: #d35400;
      font-size: 1.1em;
    }

    .correcta {
      color: #27ae60;
      font-weight: bold;
    }

    .incorrecta {
      color: #c0392b;
      font-weight: bold;
    }

    .sugerencia {
      color: #f39c12;
      font-weight: bold;
    }

    .boton-guardar {
      background: #27ae60 !important;
    }

    .boton-guardar:hover {
      background: #219653 !important;
    }

    /* Lista personal */
    .lista {
      margin-top: 40px;
      padding-top: 20px;
      border-top: 2px solid #0077cc;
    }

    .lista h2 {
      color: #003366;
      font-size: 20px;
      margin-bottom: 15px;
    }

    .palabra-item {
      padding: 12px 16px;
      background: #f8f9fa;
      margin: 6px 0;
      border-radius: 10px;
      border-left: 5px solid #0077cc;
      font-weight: 500;
      color: #2c3e50;
    }

    /* Modo pr√°ctica */
    .modo-practica {
      background: #fff8e1;
      padding: 20px;
      border-radius: 16px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      margin-top: 25px;
      border: 1px dashed #ff9800;
    }

    /* Responsive: se ve bien en celular */
    @media (max-width: 600px) {
      input[type="text"] { 
        width: 100%; 
        margin-bottom: 10px;
      }
      body { 
        padding: 15px; 
      }
      .logo-container img {
        max-width: 250px;
      }
      button {
        width: 100%;
        margin: 5px 0;
      }
    }
  </style>
</head>
<body>

  <!-- Logo de AcentoF√°cil -->
  <div class="logo-container">
    <img src="images/logo-acentofacil.png" alt="Logo AcentoF√°cil">
  </div>
  <p class="subtitle">Aprende la acentuaci√≥n en espa√±ol con reglas claras y audio</p>

  <!-- Entrada de texto -->
  <input type="text" id="entrada" placeholder="Escribe una palabra..." />
  <button onclick="analizar()">üîç Analizar</button>
  <button onclick="modoPractica()">üéØ Modo pr√°ctica</button>

  <!-- Resultado del an√°lisis -->
  <div id="resultado"></div>
  <div id="guardado"></div>

  <!-- Lista personal -->
  <div class="lista">
    <h2>üìö Mi lista personal</h2>
    <div id="lista-personal"></div>
  </div>

  <!-- Modo pr√°ctica -->
  <div id="practica" style="display:none;" class="modo-practica"></div>

  <!-- Registrar Service Worker -->
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('sw.js').catch(e => console.log('SW no registrado:', e));
    }
  </script>

  <!-- L√≥gica principal de la app -->
  <script>
    // Diccionario de palabras correctas con traducci√≥n al franc√©s
    const diccionarioCorrecto = {
      "caf√©": "caf√©",
      "jam√≥n": "jambon",
      "comer": "manger",
      "f√°cil": "facile",
      "casa": "maison",
      "tel√©fono": "t√©l√©phone",
      "m√∫sica": "musique",
      "d√≠ganselo": "dites-le-lui",
      "ac√©rcate": "approche-toi",
      "qu√≠temelo": "enlevez-le-le",
      "paralelep√≠pedo": "parall√©l√©pip√®de",
      "esdr√∫jula": "mot esdr√∫jule",
      "s√≠laba": "syllabe",
      "r√©gimen": "r√©gime",
      "estad√≠stica": "statistique"
    };

    // === Encontrar correcci√≥n si el usuario se equivoca ===
    function encontrarCorreccion(palabra) {
      if (diccionarioCorrecto[palabra]) return null;

      // Quitar tildes para comparar
      const sinTilde = palabra.normalize('NFD').replace(/[\u0300-\u036f]/g, "").toLowerCase();
      for (const key in diccionarioCorrecto) {
        const sinTildeKey = key.normalize('NFD').replace(/[\u0300-\u036f]/g, "").toLowerCase();
        if (sinTildeKey === sinTilde && key !== palabra) {
          return key;
        }
      }
      return null;
    }

    // === Silabeo mejorado ===
    function silabear(palabra) {
      const silabas = [];
      let actual = '';
      const todas = 'aeiou√°√©√≠√≥√∫√º';
      const consonantes = 'bcdfghjklmnpqrstvwxyz';

      for (let i = 0; i < palabra.length; i++) {
        let c = palabra[i];
        actual += c;

        if (todas.includes(c) && i + 2 < palabra.length) {
          let sig = palabra[i + 1];
          let post = palabra[i + 2];
          if (consonantes.includes(sig) && todas.includes(post)) {
            let grupo = palabra.slice(i, i + 2);
            if (!['ch', 'll', 'gu', 'qu'].includes(grupo)) {
              silabas.push(actual);
              actual = '';
            }
          }
        } else if (i === palabra.length - 1) {
          silabas.push(actual);
        }
      }

      if (actual && silabas.length === 0) silabas.push(actual);
      return silabas;
    }

    // === Analizar palabra ===
    function analizarPalabra(palabra) {
      palabra = palabra.toLowerCase().trim();
      if (!palabra) return { error: "Vac√≠o" };

      const silabas = silabear(palabra);
      const numSilabas = silabas.length;
      const tieneTilde = /√°|√©|√≠|√≥|√∫/.test(palabra);
      const ultimaLetra = palabra.slice(-1);
      const terminaEnVNS = ['a','e','i','o','u','n','s'].includes(ultimaLetra);

      let tonica = terminaEnVNS ? numSilabas - 2 : numSilabas - 1;
      if (tieneTilde) {
        for (let i = 0; i < silabas.length; i++) {
          if (/√°|√©|√≠|√≥|√∫/.test(silabas[i])) {
            tonica = i; break;
          }
        }
      }
      if (tonica < 0) tonica = 0;
      if (tonica >= numSilabas) tonica = numSilabas - 1;

      const tipo = 
        tonica === numSilabas - 1 ? 'aguda' :
        tonica === numSilabas - 2 ? 'grave' :
        tonica === numSilabas - 3 ? 'esdr√∫jula' : 'sobreesdr√∫jula';

      const debeTilde = 
        (tipo === 'aguda' && terminaEnVNS) ||
        (tipo === 'grave' && !terminaEnVNS) ||
        (tipo === 'esdr√∫jula' || tipo === 'sobreesdr√∫jula');

      const regla = tipo === 'aguda' ? 
        (debeTilde ? 'Lleva tilde por ser aguda y terminar en vocal, n o s.' : 'No lleva tilde por terminar en consonante (no n ni s).') :
        tipo === 'grave' ? 
          (debeTilde ? 'Lleva tilde por no terminar en vocal, n o s.' : 'No lleva tilde por terminar en vocal, n o s.') :
          'Siempre lleva tilde por ser esdr√∫jula o sobreesdr√∫jula.';

      return {
        palabra, silabas, tonica, tipo, debe_tilde: debeTilde,
        tiene_tilde: tieneTilde,
        escribio_bien: (tieneTilde && debeTilde) || (!tieneTilde && !debeTilde),
        regla, traduccion: diccionarioCorrecto[palabra] || 'no disponible',
        silabasTexto: silabas.map((s, i) => i === tonica ? `**${s}**` : s).join(' - ')
      };
    }

    // === Analizar entrada ===
    function analizar() {
      const palabra = document.getElementById("entrada").value.trim();
      if (!palabra) return;

      const sugerida = encontrarCorreccion(palabra);
      if (sugerida && palabra !== sugerida) {
        const resDiv = document.getElementById("resultado");
        resDiv.innerHTML = `
          <p class="sugerencia">‚ùå "${palabra}" no se escribe as√≠.</p>
          <p>¬øQuisiste decir: <strong>${sugerida}</strong>?
            <button onclick="document.getElementById('entrada').value='${sugerida}'; analizar();">
              Usar "${sugerida}"
            </button>
          </p>
        `;
        document.getElementById("guardado").innerHTML = "";
        return;
      }

      const result = analizarPalabra(palabra);
      const resDiv = document.getElementById("resultado");
      const guardarDiv = document.getElementById("guardado");

      if (result.error) {
        resDiv.innerHTML = `<p style="color:red">${result.error}</p>`;
        return;
      }

      let html = `
        <div class="resultado">
          <p><strong>üî§ Palabra:</strong> ${result.palabra}</p>
          <p><strong>üß© S√≠labas:</strong> <span class="silabas">${result.silabasTexto}</span></p>
          <p><strong>üéØ Tipo:</strong> ${result.tipo}</p>
          <p><strong>‚úçÔ∏è ¬øLleva tilde?</strong> ${result.debe_tilde ? 'S√≠' : 'No'}</p>
          <p><strong>üìò Regla:</strong> ${result.regla}</p>
          <p><strong>üá´üá∑ Franc√©s:</strong> ${result.traduccion}</p>
          <p><button onclick="pronunciar('${result.palabra}')">üîä Pronunciar</button></p>
          <p class="${result.escribio_bien ? 'correcta' : 'incorrecta'}">
            ${result.escribio_bien ? '‚úÖ Escritura correcta' : '‚ùå Corrige la tilde'}
          </p>
        </div>
      `;
      resDiv.innerHTML = html;

      if (result.escribio_bien) {
        guardarDiv.innerHTML = `
          <button class="boton-guardar" onclick="guardarPalabra('${result.palabra}')">
            ‚úÖ Guardar en mi lista
          </button>
        `;
      } else {
        guardarDiv.innerHTML = "";
      }

      mostrarLista();
    }

    // === Audio ===
    function pronunciar(texto) {
      window.speechSynthesis.cancel();
      const u = new SpeechSynthesisUtterance(texto);
      u.lang = 'es-ES'; u.rate = 0.9; u.pitch = 1;
      window.speechSynthesis.speak(u);
    }

    // === Guardar palabra ===
    function guardarPalabra(palabra) {
      let lista = JSON.parse(localStorage.getItem("listaAcentoFacil") || "[]");
      if (!lista.includes(palabra)) {
        lista.push(palabra);
        localStorage.setItem("listaAcentoFacil", JSON.stringify(lista));
        alert(`¬°"${palabra}" guardada!`);
        mostrarLista();
      } else {
        alert("Ya guardaste esta palabra.");
      }
    }

    // === Mostrar lista ===
    function mostrarLista() {
      let lista = JSON.parse(localStorage.getItem("listaAcentoFacil") || "[]");
      const cont = document.getElementById("lista-personal");
      cont.innerHTML = lista.length === 0 
        ? "<p>Ninguna palabra guardada.</p>"
        : lista.map(p => `<div class="palabra-item">üìò ${p}</div>`).join('');
    }

    // === Modo pr√°ctica ===
    function modoPractica() {
      const palabras = Object.keys(diccionarioCorrecto).filter(p => p.length > 4);
      const palabra = palabras[Math.floor(Math.random() * palabras.length)];
      const cont = document.getElementById("practica");
      cont.style.display = "block";
      cont.innerHTML = `
        <p><strong>‚ùì ¬øQu√© tipo de palabra es: "${palabra}"?</strong></p>
        <button onclick="verificar('${palabra}', 'aguda')">Aguda</button>
        <button onclick="verificar('${palabra}', 'grave')">Grave</button>
        <button onclick="verificar('${palabra}', 'esdr√∫jula')">Esdr√∫jula</button>
        <button onclick="verificar('${palabra}', 'sobreesdr√∫jula')">Sobreesdr√∫jula</button>
      `;
    }

    function verificar(palabra, respuesta) {
      const correcta = analizarPalabra(palabra).tipo;
      const cont = document.getElementById("practica");
      if (respuesta === correcta) {
        cont.innerHTML += "<p style='color:green'>‚úÖ ¬°Correcto!</p>";
      } else {
        cont.innerHTML += `<p style='color:red'>‚ùå Era ${correcta}.</p>`;
      }
    }

    // === Cargar al inicio ===
    window.onload = function() {
      if ('speechSynthesis' in window) {
        window.speechSynthesis.getVoices();
      }
      mostrarLista();
    };
  </script>
</body>
</html>
