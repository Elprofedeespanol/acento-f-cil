<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>AcentoF√°cil</title>
  <link rel="manifest" href="manifest.json" />
  <style>
    body { font-family: Arial, sans-serif; max-width: 800px; margin: 40px auto; padding: 20px; }
    input, button { padding: 10px; font-size: 16px; }
    .resultado { margin-top: 20px; padding: 15px; background: #f0f8ff; border-radius: 8px; }
    .correcta { color: green; }
    .incorrecta { color: red; }
    .guardada { color: blue; }
    .silabas { font-weight: bold; }
    .boton-guardar { margin-top: 10px; padding: 8px 16px; background: #005500; color: white; border: none; cursor: pointer; }
    .lista { margin-top: 30px; }
    .palabra-item { padding: 8px; border-bottom: 1px solid #ddd; }
  </style>
</head>
<body>
  <h1>AcentoF√°cil üá™üá∏ ‚Üî üá´üá∑</h1>
  <p>Analiza palabras en espa√±ol y aprende la regla de acentuaci√≥n.</p>

  <input type="text" id="entrada" placeholder="Escribe una palabra..." />
  <button onclick="analizar()">Analizar</button>

  <div id="resultado"></div>
  <div id="guardado"></div>

  <div class="lista">
    <h2>Mi lista personal</h2>
    <div id="lista-personal"></div>
  </div>

  <script>
    const diccionarioFrances = {
      "caf√©": "caf√©", "jam√≥n": "jambon", "comer": "manger", "f√°cil": "facile",
      "casa": "maison", "tel√©fono": "t√©l√©phone", "m√∫sica": "musique", 
      "d√≠ganselo": "dites-le-lui", "ac√©rcate": "approche-toi", "qu√≠temelo": "enlevez-le-le"
    };

    function analizarPalabra(palabra) {
      palabra = palabra.toLowerCase().trim();
      const vocales = 'aeiou√°√©√≠√≥√∫√º';
      const fuertes = 'aeo√°√©√≥';
      const debiles = 'iu√≠√∫√º';
      const consonantes = 'bcdfghjklmnpqrstvwxyz';

      function silabear(palabra) {
        let silabas = [];
        let actual = '';
        let i = 0;

        while (i < palabra.length) {
          let letra = palabra[i];
          let siguiente = i + 1 < palabra.length ? palabra[i + 1] : '';
          let posterior = i + 2 < palabra.length ? palabra[i + 2] : '';

          actual += letra;

          if (vocales.includes(letra)) {
            if (consonantes.includes(siguiente) && vocales.includes(posterior)) {
              silabas.push(actual);
              actual = '';
            } else if (vocales.includes(siguiente)) {
              let par = letra + siguiente;
              if (fuertes.includes(letra) && fuertes.includes(siguiente)) {
                silabas.push(actual);
                actual = '';
              } else if (letra.match(/[√°√©√≠√≥√∫]/) || siguiente.match(/[√°√©√≠√≥√∫]/)) {
                silabas.push(actual);
                actual = '';
              } else if (letra === 'u' && siguiente === 'i') {
                silabas.push(actual);
                actual = '';
              } else {
                actual += siguiente;
                i++;
              }
            } else if (i === palabra.length - 1) {
              silabas.push(actual);
              actual = '';
            }
          } else if (i === palabra.length - 1) {
            actual += letra;
            silabas.push(actual);
            actual = '';
          }
          i++;
        }

        if (actual) silabas.push(actual);
        return silabas;
      }

      const silabas = silabear(palabra);
      const numSilabas = silabas.length;
      let tonica;
      const ultimaLetra = palabra.slice(-1);
      const tieneTilde = [...palabra].some(c => '√°√©√≠√≥√∫'.includes(c));

      if (['n', 's', 'a', 'e', 'i', 'o', 'u'].includes(ultimaLetra)) {
        tonica = numSilabas - 2;
      } else {
        tonica = numSilabas - 1;
      }

      if (tieneTilde) {
        for (let i = 0; i < silabas.length; i++) {
          if (['√°','√©','√≠','√≥','√∫'].some(t => silabas[i].includes(t))) {
            tonica = i;
            break;
          }
        }
      }
      if (tonica < 0) tonica = 0;

      let tipo;
      if (tonica === numSilabas - 1) tipo = 'aguda';
      else if (tonica === numSilabas - 2) tipo = 'grave';
      else if (tonica === numSilabas - 3) tipo = 'esdr√∫jula';
      else tipo = 'sobreesdr√∫jula';

      let debeTilde = false;
      const terminaEnVNS = ['a','e','i','o','u','n','s'].includes(ultimaLetra);
      if (tipo === 'aguda' && terminaEnVNS) debeTilde = true;
      else if (tipo === 'grave' && !terminaEnVNS) debeTilde = true;
      else if (tipo === 'esdr√∫jula' || tipo === 'sobreesdr√∫jula') debeTilde = true;

      const escribioBien = (tieneTilde && debeTilde) || (!tieneTilde && !debeTilde);

      let regla = '';
      if (tipo === 'aguda') {
        regla = debeTilde 
          ? 'Lleva tilde porque termina en vocal, n o s y el acento est√° en la √∫ltima s√≠laba.' 
          : 'No lleva tilde porque termina en consonante (no n ni s).';
      } else if (tipo === 'grave') {
        regla = debeTilde 
          ? 'Lleva tilde porque NO termina en vocal, n o s.' 
          : 'No lleva tilde porque termina en vocal, n o s.';
      } else {
        regla = 'Siempre lleva tilde por ser ' + tipo + '.';
      }

      return {
        palabra: palabra,
        silabas: silabas,
        tonica: tonica,
        tipo: tipo,
        debe_tilde: debeTilde,
        tiene_tilde: tieneTilde,
        escribio_bien: escribioBien,
        regla: regla,
        traduccion: diccionarioFrances[palabra] || 'no disponible',
        silabasTexto: silabas.map((s, i) => i === tonica ? `**${s}**` : s).join(' - ')
      };
    }

    window.speechSynthesis.getVoices();

    function analizar() {
      const palabra = document.getElementById("entrada").value.trim();
      if (!palabra) return;

      const result = analizarPalabra(palabra);
      const resDiv = document.getElementById("resultado");
      const guardarDiv = document.getElementById("guardado");

      let html = `
        <div class="resultado">
          <p><strong>Palabra:</strong> ${result.palabra}</p>
          <p><strong>S√≠labas:</strong> <span class="silabas">${result.silabasTexto}</span></p>
          <p><strong>Tipo:</strong> ${result.tipo}</p>
          <p><strong>¬øLleva tilde?</strong> ${result.debe_tilde ? 'S√≠' : 'No'}</p>
          <p><strong>Regla:</strong> ${result.regla}</p>
          <p><strong>Franc√©s:</strong> ${result.traduccion}</p>
          <p><button onclick="pronunciar('${result.palabra}')">üîä Pronunciar</button></p>
          <p class="${result.escribio_bien ? 'correcta' : 'incorrecta'}">
            ${result.escribio_bien ? '‚úÖ Escritura correcta' : '‚ùå Corrige la tilde'}
          </p>
        </div>
      `;
      resDiv.innerHTML = html;

      if (result.escribio_bien) {
        guardarDiv.innerHTML = `
          <button class="boton-guardar" onclick="guardarPalabra('${result.palabra}')">
            Guardar en mi lista
          </button>
        `;
      } else {
        guardarDiv.innerHTML = "";
      }

      mostrarLista();
    }

    function pronunciar(texto) {
      window.speechSynthesis.cancel();
      const utterance = new SpeechSynthesisUtterance(texto);
      utterance.lang = 'es-ES';
      utterance.rate = 0.9;
      utterance.pitch = 1;
      const voces = window.speechSynthesis.getVoices();
      const voz = voces.find(v => v.lang.startsWith('es'));
      if (voz) utterance.voice = voz;
      window.speechSynthesis.speak(utterance);
    }

    function guardarPalabra(palabra) {
      let lista = JSON.parse(localStorage.getItem("listaAcentoFacil") || "[]");
      if (!lista.includes(palabra)) {
        lista.push(palabra);
        localStorage.setItem("listaAcentoFacil", JSON.stringify(lista));
        alert("¬°Palabra guardada!");
        mostrarLista();
      }
    }

    function mostrarLista() {
      let lista = JSON.parse(localStorage.getItem("listaAcentoFacil") || "[]");
      const cont = document.getElementById("lista-personal");
      cont.innerHTML = lista.length === 0 
        ? "<p>Ninguna palabra guardada.</p>"
        : lista.map(p => `<div class="palabra-item">${p}</div>`).join('');
    }

    mostrarLista();
  </script>
</body>
</html>